# **SQLD Day 23 – 복원 기출 2회 해설, 다중행 서브쿼리·윈도우 함수 분석 (2025-11-04)**

> 📘 SQLD 2과목 | SQL 기본 및 응용  
> 🧑‍💻 학습자: Jaerok Kim (Raprok612)

---

## **🎯 학습 목표**

- SQLD 복원 기출 2회(다중행 서브쿼리, 윈도우 함수 중심) 해설 및 실전 분석  
- 실전형 문제를 통해 데이터 비교·순위·집계 로직을 종합적으로 이해  
- 성능과 정확성을 고려한 쿼리 작성 습관 확립

---

## **🧠 이론 정리**

### **1️⃣ 다중행 서브쿼리 (Multi-row Subquery)**

| 연산자 | 설명 | 예시 |
|--------|------|------|
| **IN** | 여러 값 중 일치 여부 검사 | `WHERE DEPTNO IN (10, 20)` |
| **ANY / SOME** | 하위 쿼리 결과 중 하나라도 만족 | `SAL > ANY (SELECT SAL FROM EMP WHERE JOB='SALESMAN')` |
| **ALL** | 모든 결과 만족 시 TRUE | `SAL > ALL (SELECT SAL FROM EMP WHERE JOB='CLERK')` |

> 💡 ANY는 “최소 조건”, ALL은 “최대 조건” 개념으로 이해하면 빠르다.

```sql
SELECT ENAME, SAL
FROM EMP
WHERE SAL > ALL (SELECT SAL FROM EMP WHERE DEPTNO = 20);
```

---

### **2️⃣ 윈도우 함수 (Window Function)**

> 행 단위의 누적·순위·비율 계산을 수행하는 고급 함수

| 함수 | 의미 | 예시 |
|------|------|------|
| **RANK()** | 동일값 순위 건너뜀 | 1, 2, 2, 4 |
| **DENSE_RANK()** | 동일값 순위 연속 | 1, 2, 2, 3 |
| **ROW_NUMBER()** | 고유한 순번 부여 | 1, 2, 3, 4 |
| **NTILE(n)** | n등분 그룹 번호 | 1, 1, 2, 2 |
| **SUM() OVER()** | 누적합 | `SUM(SAL) OVER (ORDER BY SAL)` |

```sql
SELECT ENAME, SAL,
       RANK() OVER (ORDER BY SAL DESC) AS R1,
       DENSE_RANK() OVER (ORDER BY SAL DESC) AS R2,
       ROW_NUMBER() OVER (ORDER BY SAL DESC) AS RN
FROM EMP;
```

> ⚙️ PARTITION BY로 그룹 단위 순위 계산 가능.

---

## **🧮 예제 및 실습**

**예제 1️⃣ – ANY / ALL 비교**
```sql
SELECT ENAME, SAL
FROM EMP
WHERE SAL > ANY (SELECT SAL FROM EMP WHERE DEPTNO = 30);
```

**예제 2️⃣ – 윈도우 함수 RANK**
```sql
SELECT DEPTNO, ENAME, SAL,
       RANK() OVER (PARTITION BY DEPTNO ORDER BY SAL DESC) AS RANK_SAL
FROM EMP;
```

**예제 3️⃣ – 누적 합계**
```sql
SELECT DEPTNO, ENAME, SAL,
       SUM(SAL) OVER (PARTITION BY DEPTNO ORDER BY SAL) AS RUNNING_TOTAL
FROM EMP;
```

- [x] 다중행 서브쿼리 IN / ANY / ALL 실습  
- [x] RANK / DENSE_RANK 차이 확인  
- [x] 누적 합계 (SUM OVER) 구현 완료

---

## **🧾 기출 복습**

| 회차 | 문항 | 주제 | 결과 | 비고 |
|------|------|------|------|------|
| 복원 2회 | Q1–Q10 | 다중행 서브쿼리 | ✅ | ANY / ALL 조건 명확히 구분 |
| 복원 2회 | Q11–Q15 | 윈도우 함수 | ✅ | RANK / DENSE_RANK 차이 숙지 |
| 복원 2회 | Q16–Q20 | 누적 집계 실습 | ⚠ | PARTITION BY 기준 혼동 |

> 📘 기출 출처: 아이리포 SQLD 강의 – 복원 기출문제 2회 (유튜브 40-1~40-5강)

---

## **💬 느낀점 / 메모**

- ANY / ALL 구문의 의미를 완벽히 구분해야 문제 해석 속도가 빨라진다.  
- RANK와 DENSE_RANK의 순위 중복 처리 차이를 실제 예제로 확인함.  
- 누적 합계 문제는 PARTITION BY 기준을 잘못 설정하면 오답이 나올 수 있음.  

---

## **🔗 참고자료**

- 아이리포 SQLD 강의 – 2과목 복원기출 2회 해설 (유튜브 40-1~40-5강): 다중행 서브쿼리 / 윈도우 함수 / 누적 집계  
- SQLD 공식 교재 2권 p.287~298  
- [아이리포 공식 유튜브 채널 – SQLD 모든 것](https://www.youtube.com/@irepo_official)
