# **SQLD Day 18 – 복합쿼리 실전 ② (서브쿼리 · 집계 · 조건 결합) (2025-10-30)**

> 📘 SQLD 2과목 | SQL 기본 및 응용  
> 🧑‍💻 학습자: Jaerok Kim (Raprok612)

---

## 🎯 학습 목표
- 서브쿼리 + 집계 + 조건을 결합한 실전형 SQL 해결  
- 단일행/다중행/상관 서브쿼리의 차이 명확히 이해  
- 인라인 뷰를 활용한 정렬·필터링 패턴 숙지  
- 복합쿼리 문제에서 흐름을 읽는 능력 강화  

---

## 🧠 이론 정리

### 1️⃣ 서브쿼리 종류 및 특징

| 유형 | 설명 | 연산자 |
|------|------|--------|
| **단일행 서브쿼리** | 결과가 1개 | `=`, `>`, `<` |
| **다중행 서브쿼리** | 여러 행 반환 | `IN`, `ANY`, `ALL` |
| **상관 서브쿼리** | 외부행과 함께 수행 | 행마다 재계산됨 |
| **다중컬럼 서브쿼리** | 여러 컬럼 비교 | `(col1, col2) IN (SELECT ...)` |

---

## 🧩 주요 문제 패턴

### ✔ 패턴 1 — 전체 평균보다 급여 높은 사원  
```sql
SELECT ename, sal
FROM emp
WHERE sal > (SELECT AVG(sal) FROM emp);
```

---

### ✔ 패턴 2 — 상관 서브쿼리: 부서 내 최고급여와 비교  
```sql
SELECT e1.ename, e1.sal
FROM emp e1
WHERE e1.sal = (
      SELECT MAX(e2.sal)
      FROM emp e2
      WHERE e2.deptno = e1.deptno
);
```

---

### ✔ 패턴 3 — 인라인 뷰 + 정렬 후 ROWNUM 필터링  
```sql
SELECT *
FROM (
    SELECT ename, sal
    FROM emp
    ORDER BY sal DESC
)
WHERE ROWNUM <= 3;
```

---

### ✔ 패턴 4 — 다중행 서브쿼리  
```sql
SELECT ename, sal
FROM emp
WHERE sal IN (SELECT MAX(sal) FROM emp GROUP BY deptno);
```

---

## ⚙️ 핵심 요약
- 서브쿼리는 외부쿼리에 필요한 값을 먼저 가져오는 구조  
- 단일행/다중행/상관 여부를 먼저 판단해야 연산자를 선택할 수 있음  
- 인라인뷰는 정렬 후 필터링할 때 필요한 필수 패턴  
- 복합쿼리는 개념 하나가 아니라 여러 개념을 “흐름”으로 이해해야 함  

---

## 🧾 기출 복습

| 회차 | 문항 | 주제 | 비고 |
|------|------|--------|------|
| 기출 2회 | Q21–Q25 | 서브쿼리 | 단일행/다중행 주의 |
| 기출 1회 | Q11–Q15 | 상관 서브쿼리 | 실행 흐름 중요 |
| 기출 3회 | Q26–Q30 | 인라인 뷰 | ORDER BY와의 순서 |

---

## 💬 느낀점
- 서브쿼리는 “조건에 따라 실행되는 위치”가 다르기 때문에 단순 암기가 아니라 구조를 이해해야 했다.  
- 특히 상관 서브쿼리는 머릿속에서 반복 수행 흐름을 그려야 이해가 가능했다.  
- 복합쿼리는 여러 기술을 하나의 흐름 안에서 연결하는 능력이 필요함을 느꼈다.

---

## 🔗 참고자료
- 아이리포 SQLD 강의 – 2과목 18강  
- SQLD 공식 교재 2권 p.226~240  
